
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Client · rpcx Programming</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="smallnest <smallnest@gmail.com>">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-multipart/multipart.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-footer-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-timeline/timeline.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../part2/registry.html" />
    
    
    <link rel="prev" href="server.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="http://rpcx.site/" target="_blank" class="custom-link">rpcx官方站点</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        <li class="header">Part Ⅰ</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                        <b>1.1.</b>
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="quickstart.html">
            
                <a href="quickstart.html">
            
                    
                        <b>1.2.</b>
                    
                    QuickStart
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="server.html">
            
                <a href="server.html">
            
                    
                        <b>1.3.</b>
                    
                    Server
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4" data-path="client.html">
            
                <a href="client.html">
            
                    
                        <b>1.4.</b>
                    
                    Client
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part Ⅱ</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../part2/registry.html">
            
                <a href="../part2/registry.html">
            
                    
                        <b>2.1.</b>
                    
                    Registry
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../part2/registry.html">
            
                <a href="../part2/registry.html#peer2peer">
            
                    
                        <b>2.1.1.</b>
                    
                    Peer to Peer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="../part2/registry.html">
            
                <a href="../part2/registry.html#multiple">
            
                    
                        <b>2.1.2.</b>
                    
                    Peer to Multiple
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="../part2/registry.html">
            
                <a href="../part2/registry.html#zookeeper">
            
                    
                        <b>2.1.3.</b>
                    
                    Zookeeper
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="../part2/registry.html">
            
                <a href="../part2/registry.html#etcd">
            
                    
                        <b>2.1.4.</b>
                    
                    Etcd
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.5" data-path="../part2/registry.html">
            
                <a href="../part2/registry.html#consul">
            
                    
                        <b>2.1.5.</b>
                    
                    Consul
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.6" data-path="../part2/registry.html">
            
                <a href="../part2/registry.html#mdns">
            
                    
                        <b>2.1.6.</b>
                    
                    mDNS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.7" data-path="../part2/registry.html">
            
                <a href="../part2/registry.html#inprocess">
            
                    
                        <b>2.1.7.</b>
                    
                    In process
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Part Ⅱ</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../part3/codec.html">
            
                <a href="../part3/codec.html">
            
                    
                        <b>3.1.</b>
                    
                    Codec
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../part3/failmode.html">
            
                <a href="../part3/failmode.html">
            
                    
                        <b>3.2.</b>
                    
                    FailMode
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="../part3/failmode.html">
            
                <a href="../part3/failmode.html#failfast">
            
                    
                        <b>3.2.1.</b>
                    
                    Failfast
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="../part3/failmode.html">
            
                <a href="../part3/failmode.html#failover">
            
                    
                        <b>3.2.2.</b>
                    
                    Failover
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.3" data-path="../part3/failmode.html">
            
                <a href="../part3/failmode.html#failtry">
            
                    
                        <b>3.2.3.</b>
                    
                    Failtry
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../part3/selector.html">
            
                <a href="../part3/selector.html">
            
                    
                        <b>3.3.</b>
                    
                    Selector
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="../part3/selector.html">
            
                <a href="../part3/selector.html#random_selector">
            
                    
                        <b>3.3.1.</b>
                    
                    Random
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="../part3/selector.html">
            
                <a href="../part3/selector.html#roundrobin_selector">
            
                    
                        <b>3.3.2.</b>
                    
                    Roundrobin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.3" data-path="../part3/selector.html">
            
                <a href="../part3/selector.html#hash_selector">
            
                    
                        <b>3.3.3.</b>
                    
                    Consistent hashing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.4" data-path="../part3/selector.html">
            
                <a href="../part3/selector.html#weighted_selector">
            
                    
                        <b>3.3.4.</b>
                    
                    Weighted
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.5" data-path="../part3/selector.html">
            
                <a href="../part3/selector.html#ping_selector">
            
                    
                        <b>3.3.5.</b>
                    
                    Network quality
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.6" data-path="../part3/selector.html">
            
                <a href="../part3/selector.html#geo_selector">
            
                    
                        <b>3.3.6.</b>
                    
                    Geography
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.7" data-path="../part3/selector.html">
            
                <a href="../part3/selector.html#user_selector">
            
                    
                        <b>3.3.7.</b>
                    
                    Customized Selector
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Part Ⅳ Plugins</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../part4/metrics.html">
            
                <a href="../part4/metrics.html">
            
                    
                        <b>4.1.</b>
                    
                    Metrics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../part4/rate-limiting.html">
            
                <a href="../part4/rate-limiting.html">
            
                    
                        <b>4.2.</b>
                    
                    Rate Limiting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../part4/alias.html">
            
                <a href="../part4/alias.html">
            
                    
                        <b>4.3.</b>
                    
                    Alias
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="../part4/auth.md">
            
                <span>
            
                    
                        <b>4.4.</b>
                    
                    Auth
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="../part4/plugin-dev.html">
            
                <a href="../part4/plugin-dev.html">
            
                    
                        <b>4.5.</b>
                    
                    Plugin Development
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part Ⅴ  Others</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../part5/benchmark.html">
            
                <a href="../part5/benchmark.html">
            
                    
                        <b>5.1.</b>
                    
                    Benchmark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../part5/ui.html">
            
                <a href="../part5/ui.html">
            
                    
                        <b>5.2.</b>
                    
                    UI Manager
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../part5/protocol.html">
            
                <a href="../part5/protocol.html">
            
                    
                        <b>5.3.</b>
                    
                    protocol
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Client</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="client"><a name="client" class="plugin-anchor" href="#client"><i class="fa fa-link" aria-hidden="true"></i></a>Client</h1>
<p>Clients use the same transport protocol to send requests to services and get responses from them.</p>
<pre><code class="lang-go"><span class="hljs-keyword">type</span> Client <span class="hljs-keyword">struct</span> {
    Conn net.Conn

    Plugins PluginContainer
    <span class="hljs-comment">// contains filtered or unexported fields</span>
}
</code></pre>
<p><code>Conn</code> is the connection between client and server and <code>Plugins</code> contains client plugins.</p>
<p>It has methods:</p>
<pre><code class="lang-go">    <span class="hljs-keyword">func</span> (client *Client) Call(ctx context.Context, servicePath, serviceMethod <span class="hljs-keyword">string</span>, args <span class="hljs-keyword">interface</span>{}, reply <span class="hljs-keyword">interface</span>{}) error
    <span class="hljs-keyword">func</span> (client *Client) Close() error
    <span class="hljs-keyword">func</span> (c *Client) Connect(network, address <span class="hljs-keyword">string</span>) error
    <span class="hljs-keyword">func</span> (client *Client) Go(ctx context.Context, servicePath, serviceMethod <span class="hljs-keyword">string</span>, args <span class="hljs-keyword">interface</span>{}, reply <span class="hljs-keyword">interface</span>{}, done <span class="hljs-keyword">chan</span> *Call) *Call
    <span class="hljs-keyword">func</span> (client *Client) IsClosing() <span class="hljs-keyword">bool</span>
    <span class="hljs-keyword">func</span> (client *Client) IsShutdown() <span class="hljs-keyword">bool</span>
</code></pre>
<p><code>Call</code> is a synchronous service invocation&#x3002; Clients are blocked until response are received or some errors are returned. While <code>Go</code> is an asynchronous invocation. It returns a Call pointer and you can check the <code>*Call</code> to get the result or the error.</p>
<p><code>Close</code> closes the connnection to the service. It won&apos;t wait unfinished requests and closes the connection inmmediately.</p>
<p><code>IsClosing</code> indicates the client is closing and won&apos;t accept new invocations.
<code>IsShutdown</code> indicates the client won&apos;t receive responses from the service.</p>
<p><code>Client</code> uses the default <a href="https://godoc.org/github.com/rubyist/circuitbreaker#NewRateBreaker" target="_blank">CircuitBreaker (circuit.NewRateBreaker(0.95, 100))</a> to handle errors. This is a poplular rpc error handling style. When the error rate hits the threshold, this service is marked unavailable in 10 second window. You can implement your customzied CircuitBreaker.</p>
<p>There is a client example:</p>
<pre><code class="lang-go">    client := &amp;Client{
        option: DefaultOption,
    }

    err := client.Connect(<span class="hljs-string">&quot;tcp&quot;</span>, addr)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        t.Fatalf(<span class="hljs-string">&quot;failed to connect: %v&quot;</span>, err)
    }
    <span class="hljs-keyword">defer</span> client.Close()

    args := &amp;Args{
        A: <span class="hljs-number">10</span>,
        B: <span class="hljs-number">20</span>,
    }

    reply := &amp;Reply{}
    err = client.Call(context.Background(), <span class="hljs-string">&quot;Arith&quot;</span>, <span class="hljs-string">&quot;Mul&quot;</span>, args, reply)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        t.Fatalf(<span class="hljs-string">&quot;failed to call: %v&quot;</span>, err)
    }

    <span class="hljs-keyword">if</span> reply.C != <span class="hljs-number">200</span> {
        t.Fatalf(<span class="hljs-string">&quot;expect 200 but got %d&quot;</span>, reply.C)
    }
</code></pre>
<h2 id="xclient"><a name="xclient" class="plugin-anchor" href="#xclient"><i class="fa fa-link" aria-hidden="true"></i></a>XClient</h2>
<p><code>XClient</code> is a client wrapper and adds some service discovery and service governance features.</p>
<pre><code class="lang-go"><span class="hljs-keyword">type</span> XClient <span class="hljs-keyword">interface</span> {
    SetPlugins(plugins PluginContainer)
    ConfigGeoSelector(latitude, longitude <span class="hljs-keyword">float64</span>)
    Auth(auth <span class="hljs-keyword">string</span>)

    Go(ctx context.Context, serviceMethod <span class="hljs-keyword">string</span>, args <span class="hljs-keyword">interface</span>{}, reply <span class="hljs-keyword">interface</span>{}, done <span class="hljs-keyword">chan</span> *Call) (*Call, error)
    Call(ctx context.Context, serviceMethod <span class="hljs-keyword">string</span>, args <span class="hljs-keyword">interface</span>{}, reply <span class="hljs-keyword">interface</span>{}) error
    Broadcast(ctx context.Context, serviceMethod <span class="hljs-keyword">string</span>, args <span class="hljs-keyword">interface</span>{}, reply <span class="hljs-keyword">interface</span>{}) error
    Fork(ctx context.Context, serviceMethod <span class="hljs-keyword">string</span>, args <span class="hljs-keyword">interface</span>{}, reply <span class="hljs-keyword">interface</span>{}) error
    Close() error
}
</code></pre>
<p><code>SetPlugins</code> set Plugin container and <code>Auth</code> set authentication token.</p>
<p><code>ConfigGeoSelector</code> is special method to set latitude and longitude of this client and use geography selector.</p>
<p>One XClient is responsable for one service and can call all methods of this service via <code>serviceMethod</code> argument. If you want to call multiple services, you must create one xclient for each service.</p>
<p>Only one shared xclient is needed for one corresponding service in a application. It can be shared by goroutines and it is goroutine-safe.</p>
<p><code>Go</code> is for async invocations and <code>Call</code> is fo sync invocations.</p>
<p>XClient use the single connection to one service node and it caches the connection until the connection is broken or closed.</p>
<h3 id="service-discovery"><a name="service-discovery" class="plugin-anchor" href="#service-discovery"><i class="fa fa-link" aria-hidden="true"></i></a>service discovery</h3>
<p>rpcx support a lot of service discovery and you can aslo implement your service discovery.</p>
<ul>
<li><ul>
<li><a href="part2/registry.md#peer2peer">Peer to Peer</a>: the client connects the single service directly. It acts like the <code>client</code> type.</li>
<li><a href="part2/registry.md#multiple">Peer to Multiple</a>: the client can connnect multiple services. Ther services are configured programmatically.</li>
<li><a href="part2/registry.md#zookeeper">Zookeeper</a>: find the services via zookeeper.</li>
<li><a href="part2/registry.md#etcd">Etcd</a>&#xFF1A; find the service via etcd.</li>
<li><a href="part2/registry.md#consul">Consul</a>: find the service via consul.</li>
<li><a href="part2/registry.md#mdns">mDNS</a>: find the service via mDNS that support local service discovery.</li>
<li><a href="part2/registry.md#inprocess">In process</a>: find services in the same process. Clients call services in process and they don&apos;t commnucaite via TCP or UDP. It is convenient in test.</li>
</ul>
</li>
</ul>
<p>There is a sync rpcx example:</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;context&quot;</span>
    <span class="hljs-string">&quot;flag&quot;</span>
    <span class="hljs-string">&quot;log&quot;</span>

    example <span class="hljs-string">&quot;github.com/rpcx-ecosystem/rpcx-examples3&quot;</span>
    <span class="hljs-string">&quot;github.com/smallnest/rpcx/client&quot;</span>
)

<span class="hljs-keyword">var</span> (
    addr = flag.String(<span class="hljs-string">&quot;addr&quot;</span>, <span class="hljs-string">&quot;localhost:8972&quot;</span>, <span class="hljs-string">&quot;server address&quot;</span>)
)

<span class="hljs-keyword">func</span> main() {
    flag.Parse()

    d := client.NewPeer2PeerDiscovery(<span class="hljs-string">&quot;tcp@&quot;</span>+*addr, <span class="hljs-string">&quot;&quot;</span>)
    xclient := client.NewXClient(<span class="hljs-string">&quot;Arith&quot;</span>, client.Failtry, client.RandomSelect, d, client.DefaultOption)
    <span class="hljs-keyword">defer</span> xclient.Close()

    args := &amp;example.Args{
        A: <span class="hljs-number">10</span>,
        B: <span class="hljs-number">20</span>,
    }

    reply := &amp;example.Reply{}
    err := xclient.Call(context.Background(), <span class="hljs-string">&quot;Mul&quot;</span>, args, reply)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Fatalf(<span class="hljs-string">&quot;failed to call: %v&quot;</span>, err)
    }

    log.Printf(<span class="hljs-string">&quot;%d * %d = %d&quot;</span>, args.A, args.B, reply.C)

}
</code></pre>
<h3 id="service-governance-fail-mode-and-load-balancing"><a name="service-governance-fail-mode-and-load-balancing" class="plugin-anchor" href="#service-governance-fail-mode-and-load-balancing"><i class="fa fa-link" aria-hidden="true"></i></a>service governance (Fail mode and Load balancing)</h3>
<p>In a large scale rpc system, there are a lot of service nodes to provide a same service. How clients select one of most appropriate node to call? If on call failed, clients should select another node or return the error immediately? They are fail mode issue and load balancing issue.</p>
<p>rpcx support fail mode:</p>
<ul>
<li><a href="part3/failmode.md#failfast">Failfast</a>&#xFF1A;  return the error immediately if call failed</li>
<li><a href="part3/failmode.md#failover">Failover</a> : select another node until reach max retries</li>
<li><a href="part3/failmode.md#failtry">Failtry</a>: select the same node and retry, until reach max retrirs</li>
</ul>
<p>For the load balancing, rpcs provides a lot of selectors:</p>
<ul>
<li><a href="part3/random_selector.md">Random</a>: select the nodes randomly<ul>
<li><a href="part3/roundrobin_selector.md">Roundrobin</a> : select the node by roundrobin</li>
<li><a href="part3/hash_selector.md">Consistent hashing</a>: select the same node if servicePath, serviceMethod and Args. It uses the <a href="https://arxiv.org/abs/1406.2294" target="_blank">jump consistent hash</a> and is very fast.</li>
<li><a href="part3/weighted_selector.md">Weighted</a>: use the weighted which is configured in metadata of services(<code>weight=xxx</code>). The algorithm is like nginx implementation(smooth weighted algorithm)</li>
<li><a href="part3/ping_selector.md">Network quality</a>: It uses the <code>ping</code> results. The better the quality of the network, the higher the probability of election of nodes</li>
<li><a href="part3/geo_selector.md">Geography</a>: If there are multiple datacenters, clients perfer to connect service in the same datacenter.</li>
<li><a href="part3/user_selector.md">Customized Selector</a>: If the above selectors are not suitable for you, you can use your customized selector. For example, one of rpcx customers has defined its selector for two datacenters because they can&apos;t use <code>Network quality</code> because of some limits.</li>
</ul>
</li>
</ul>
<p>There is an async rpcx example:</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;context&quot;</span>
    <span class="hljs-string">&quot;flag&quot;</span>
    <span class="hljs-string">&quot;log&quot;</span>

    example <span class="hljs-string">&quot;github.com/rpcx-ecosystem/rpcx-examples3&quot;</span>
    <span class="hljs-string">&quot;github.com/smallnest/rpcx/client&quot;</span>
)

<span class="hljs-keyword">var</span> (
    addr2 = flag.String(<span class="hljs-string">&quot;addr&quot;</span>, <span class="hljs-string">&quot;localhost:8972&quot;</span>, <span class="hljs-string">&quot;server address&quot;</span>)
)

<span class="hljs-keyword">func</span> main() {
    flag.Parse()

    d := client.NewPeer2PeerDiscovery(<span class="hljs-string">&quot;tcp@&quot;</span>+*addr2, <span class="hljs-string">&quot;&quot;</span>)
    xclient := client.NewXClient(<span class="hljs-string">&quot;Arith&quot;</span>, client.Failtry, client.RandomSelect, d, client.DefaultOption)
    <span class="hljs-keyword">defer</span> xclient.Close()

    args := &amp;example.Args{
        A: <span class="hljs-number">10</span>,
        B: <span class="hljs-number">20</span>,
    }

    reply := &amp;example.Reply{}
    call, err := xclient.Go(context.Background(), <span class="hljs-string">&quot;Mul&quot;</span>, args, reply, <span class="hljs-literal">nil</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Fatalf(<span class="hljs-string">&quot;failed to call: %v&quot;</span>, err)
    }

    replyCall := &lt;-call.Done
    <span class="hljs-keyword">if</span> replyCall.Error != <span class="hljs-literal">nil</span> {
        log.Fatalf(<span class="hljs-string">&quot;failed to call: %v&quot;</span>, replyCall.Error)
    } <span class="hljs-keyword">else</span> {
        log.Printf(<span class="hljs-string">&quot;%d * %d = %d&quot;</span>, args.A, args.B, reply.C)
    }
}
</code></pre>
<p>the client uses <code>Failtry</code> mode and selects the nodes randomly.</p>
<h3 id="broadcast-and-fork"><a name="broadcast-and-fork" class="plugin-anchor" href="#broadcast-and-fork"><i class="fa fa-link" aria-hidden="true"></i></a>Broadcast and Fork</h3>
<p>And for rare cases, you can use <code>Broadcast</code>&#x3001;<code>Fork</code> methods of XClient</p>
<pre><code class="lang-go">    Broadcast(ctx context.Context, serviceMethod <span class="hljs-keyword">string</span>, args <span class="hljs-keyword">interface</span>{}, reply <span class="hljs-keyword">interface</span>{}) error
    Fork(ctx context.Context, serviceMethod <span class="hljs-keyword">string</span>, args <span class="hljs-keyword">interface</span>{}, reply <span class="hljs-keyword">interface</span>{}) error
</code></pre>
<p><code>Broadcast</code> sends requests to all servers and Success only when all servers return OK.FailMode and SelectMode are meanless for this method.Please set timeout to avoid hanging.</p>
<p><code>Fork</code> sends requests to all servers and Success once any one server returns OK.
FailMode and SelectMode are meanless for this method.</p>
<p>You can use <code>NewXClient</code> to get a xclient instance.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> NewXClient(servicePath <span class="hljs-keyword">string</span>, failMode FailMode, selectMode SelectMode, discovery ServiceDiscovery, option Option) XClient
</code></pre>
<p><code>NewXClient</code> must use the service name as the first argument, then failmode, selector, discovery and other options.</p>
<footer class="page-footer-ex"> <span class="page-footer-ex-copyright"> By <em>smallnest</em> </span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <span class="page-footer-ex-footer-update"> <i>updated</i> 2017-11-04 17:56:20 </span> </footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="server.html" class="navigation navigation-prev " aria-label="Previous page: Server">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../part2/registry.html" class="navigation navigation-next " aria-label="Next page: Registry">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Client","level":"1.4","depth":1,"next":{"title":"Registry","level":"2.1","depth":1,"path":"part2/registry.md","ref":"part2/registry.md","articles":[{"title":"Peer to Peer","level":"2.1.1","depth":2,"anchor":"#peer2peer","path":"part2/registry.md","ref":"part2/registry.md#peer2peer","articles":[]},{"title":"Peer to Multiple","level":"2.1.2","depth":2,"anchor":"#multiple","path":"part2/registry.md","ref":"part2/registry.md#multiple","articles":[]},{"title":"Zookeeper","level":"2.1.3","depth":2,"anchor":"#zookeeper","path":"part2/registry.md","ref":"part2/registry.md#zookeeper","articles":[]},{"title":"Etcd","level":"2.1.4","depth":2,"anchor":"#etcd","path":"part2/registry.md","ref":"part2/registry.md#etcd","articles":[]},{"title":"Consul","level":"2.1.5","depth":2,"anchor":"#consul","path":"part2/registry.md","ref":"part2/registry.md#consul","articles":[]},{"title":"mDNS","level":"2.1.6","depth":2,"anchor":"#mdns","path":"part2/registry.md","ref":"part2/registry.md#mdns","articles":[]},{"title":"In process","level":"2.1.7","depth":2,"anchor":"#inprocess","path":"part2/registry.md","ref":"part2/registry.md#inprocess","articles":[]}]},"previous":{"title":"Server","level":"1.3","depth":1,"path":"part1/server.md","ref":"part1/server.md","articles":[]},"dir":"ltr"},"config":{"plugins":["anchors","multipart","-toc-ng","page-footer-ex","timeline","katex","disqus"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"timeline":{},"disqus":{"useIdentifier":false,"shortName":"rpcx-programming"},"page-footer-ex":{"copyright":"By <em>smallnest</em>","markdown":false,"update_format":"YYYY-MM-DD HH:mm:ss","update_label":"<i>updated</i>"},"toc":{"addClass":true,"className":"toc"},"search":{},"multipart":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"katex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true},"anchors":{}},"theme":"default","author":"smallnest <smallnest@gmail.com>","pdf":{"pageBreaksBefore":"/","headerTemplate":null,"paperSize":"a4","margin":{"right":62,"left":62,"top":36,"bottom":36},"fontSize":12,"fontFamily":"Arial","footerTemplate":null,"chapterMark":"pagebreak","pageNumbers":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"rpcx Programming","links":{"sharing":{"all":null,"facebook":null,"google":null,"twitter":null,"weibo":null},"sidebar":{"rpcx官方站点":"http://rpcx.site/"}},"gitbook":"*","description":"A guide about rpcx development"},"file":{"path":"part1/client.md","mtime":"2017-11-04T09:56:20.405Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-11-09T14:22:10.513Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

